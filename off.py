import win32api
import win32con
import win32gui
import win32com.client

# Getting an object for working with devices
wmi = win32com.client.GetObject("winmgmts:")

# Get a list of all devices
devices = wmi.ExecQuery("SELECT * FROM Win32_PnPEntity")

# Function for disabling a device by InstanceID
def disable_device(instance_id):
    try:
        # Get device object by InstanceID
        device = wmi.ExecQuery(f"SELECT * FROM Win32_PnPEntity WHERE DeviceID = '{instance_id}'")
        if device:
            # Disconnect the device
            result = device[0].Disable()
            if result == 0:
                print(f"The device with InstanceID {instance_id} has been disabled.")
            else:
                print(f"Failed to disable device with InstanceID {instance_id}.")
        else:
            print(f"Device with InstanceID {instance_id} not found.")
    except Exception as e:
        print(f"Error when disconnecting a device with InstanceID {instance_id}: {e}")

# Disconnect all peripherals
for device in devices:
    if "System" not in device.Description:
        disable_device(device.DeviceID)

print("All peripherals have been disabled.")
